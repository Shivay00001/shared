# Neon Beat Dash - Complete Project Structure

## ğŸ“ Directory Tree

```
neon-beat-dash/
â”‚
â”œâ”€â”€ game/                           # Main web game application
â”‚   â”œâ”€â”€ public/                     # Static assets
â”‚   â”‚   â”œâ”€â”€ icons/                  # PWA icons
â”‚   â”‚   â”‚   â”œâ”€â”€ icon-192.png        # 192x192 icon
â”‚   â”‚   â”‚   â”œâ”€â”€ icon-512.png        # 512x512 icon
â”‚   â”‚   â”‚   â””â”€â”€ generate-icons.html # Icon generator tool
â”‚   â”‚   â”œâ”€â”€ favicon.ico             # Browser favicon
â”‚   â”‚   â””â”€â”€ manifest.webmanifest    # PWA manifest
â”‚   â”‚
â”‚   â”œâ”€â”€ src/                        # Source code
â”‚   â”‚   â”œâ”€â”€ scenes/                 # Phaser game scenes
â”‚   â”‚   â”‚   â”œâ”€â”€ BootScene.ts        # Initial boot and setup
â”‚   â”‚   â”‚   â”œâ”€â”€ PreloadScene.ts     # Asset loading with progress
â”‚   â”‚   â”‚   â”œâ”€â”€ MenuScene.ts        # Main menu UI
â”‚   â”‚   â”‚   â”œâ”€â”€ GameScene.ts        # Core gameplay loop
â”‚   â”‚   â”‚   â”œâ”€â”€ UIScene.ts          # Overlay UI (score, combo)
â”‚   â”‚   â”‚   â””â”€â”€ GameOverScene.ts    # End screen and results
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ core/                   # Core game managers
â”‚   â”‚   â”‚   â”œâ”€â”€ GameState.ts        # Central state manager
â”‚   â”‚   â”‚   â”œâ”€â”€ AudioManager.ts     # Sound and music system
â”‚   â”‚   â”‚   â”œâ”€â”€ InputManager.ts     # Touch/keyboard input handler
â”‚   â”‚   â”‚   â”œâ”€â”€ DifficultyManager.ts # Dynamic difficulty scaling
â”‚   â”‚   â”‚   â””â”€â”€ DailyChallenge.ts   # Daily challenge system
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ services/               # Backend and data services
â”‚   â”‚   â”‚   â”œâ”€â”€ SupabaseClient.ts   # Supabase connection
â”‚   â”‚   â”‚   â”œâ”€â”€ LeaderboardService.ts # Score submission/retrieval
â”‚   â”‚   â”‚   â”œâ”€â”€ UserService.ts      # User management
â”‚   â”‚   â”‚   â””â”€â”€ StorageService.ts   # Local storage wrapper
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ui/                     # UI components
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.ts           # Reusable button component
â”‚   â”‚   â”‚   â””â”€â”€ TextStyles.ts       # Typography definitions
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ assets/                 # Game assets (placeholder)
â”‚   â”‚   â”‚   â””â”€â”€ (audio files would go here)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ main.ts                 # Game entry point
â”‚   â”‚   â””â”€â”€ gameConfig.ts           # Global configuration
â”‚   â”‚
â”‚   â”œâ”€â”€ index.html                  # HTML entry point
â”‚   â”œâ”€â”€ vite.config.ts              # Vite bundler config
â”‚   â”œâ”€â”€ package.json                # Dependencies
â”‚   â”œâ”€â”€ tsconfig.json               # TypeScript config
â”‚   â”œâ”€â”€ tsconfig.node.json          # Node TypeScript config
â”‚   â”œâ”€â”€ .env.example                # Environment template
â”‚   â””â”€â”€ .env                        # Local environment (not in git)
â”‚
â”œâ”€â”€ mobile/                         # Capacitor mobile wrapper
â”‚   â”œâ”€â”€ android/                    # Android native project
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â”œâ”€â”€ src/main/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ res/            # Android resources
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ values/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ strings.xml
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ mipmap-*/   # App icons (multiple densities)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AndroidManifest.xml
â”‚   â”‚   â”‚   â””â”€â”€ build.gradle        # App-level Gradle config
â”‚   â”‚   â”œâ”€â”€ gradle/                 # Gradle wrapper
â”‚   â”‚   â”œâ”€â”€ build.gradle            # Project-level Gradle config
â”‚   â”‚   â””â”€â”€ settings.gradle         # Gradle settings
â”‚   â”‚
â”‚   â”œâ”€â”€ capacitor.config.ts         # Capacitor configuration
â”‚   â””â”€â”€ package.json                # Mobile dependencies
â”‚
â”œâ”€â”€ infra/                          # Deployment configurations
â”‚   â”œâ”€â”€ netlify.toml                # Netlify deploy config
â”‚   â””â”€â”€ vercel.json                 # Vercel deploy config
â”‚
â”œâ”€â”€ supabase-schema.sql             # Database schema + functions
â”œâ”€â”€ README.md                       # Main documentation
â”œâ”€â”€ DEPLOYMENT-GUIDE.md             # Deployment instructions
â”œâ”€â”€ PROJECT-STRUCTURE.md            # This file
â””â”€â”€ .gitignore                      # Git ignore rules
```

## ğŸ“ File Descriptions

### Core Application Files

#### `game/src/main.ts`
- **Purpose**: Application entry point
- **Responsibilities**:
  - Initialize Phaser game instance
  - Configure scenes
  - Setup visibility change handlers
  - Remove loading screen

#### `game/src/gameConfig.ts`
- **Purpose**: Centralized configuration
- **Contains**:
  - Lane positions and dimensions
  - Player properties
  - Obstacle settings
  - Beat ring timing windows
  - Difficulty scaling parameters
  - Scoring formulas
  - Color theme

### Scene Architecture

#### `BootScene.ts`
- **Lifecycle**: First scene to run
- **Duration**: Instant
- **Purpose**: Set scale mode and orientation
- **Next Scene**: PreloadScene

#### `PreloadScene.ts`
- **Lifecycle**: Runs once at startup
- **Duration**: Until assets loaded
- **Purpose**: Load/generate all game assets
- **Features**:
  - Progress bar
  - Procedural texture generation
  - Loading text
- **Next Scene**: MenuScene

#### `MenuScene.ts`
- **Lifecycle**: Main hub, returns here after games
- **Purpose**: Navigation and high-level stats
- **Features**:
  - Play button (normal mode)
  - Daily challenge button
  - Leaderboard modal
  - Settings modal
  - Best score display
  - User initialization
- **Next Scene**: GameScene (with mode selected)

#### `GameScene.ts`
- **Lifecycle**: Active during gameplay
- **Purpose**: Core game loop
- **Features**:
  - Player movement (3 lanes)
  - Obstacle spawning and movement
  - Beat ring spawning and detection
  - Collision detection
  - Difficulty scaling
  - Score calculation
  - RNG seeding (for daily challenges)
- **Next Scene**: GameOverScene (on death)

#### `UIScene.ts`
- **Lifecycle**: Overlay during GameScene
- **Purpose**: HUD and pause menu
- **Features**:
  - Live score display
  - Combo counter
  - Pause button
  - Pause menu (resume/quit)
- **Communicates with**: GameScene via events

#### `GameOverScene.ts`
- **Lifecycle**: After game ends
- **Purpose**: Results and options
- **Features**:
  - Final score display
  - Stats breakdown (time, distance, perfect beats)
  - New best indicator
  - Top 5 leaderboard
  - Score submission
  - Play again / Share / Menu buttons
- **Next Scene**: GameScene or MenuScene

### Core Managers

#### `GameState.ts`
- **Pattern**: Singleton
- **Purpose**: Central data store
- **Manages**:
  - User ID and display name
  - Best score (persistent)
  - Last game stats (temporary)
  - Game mode (normal/daily)
  - Current seed
  - Audio settings
- **Storage**: Uses StorageService for persistence

#### `AudioManager.ts`
- **Pattern**: Singleton
- **Purpose**: Audio playback
- **Features**:
  - BGM loop (beat pattern)
  - SFX (perfect, good, collision, move)
  - Web Audio API synthesis (no files needed)
  - Mute/unmute
  - Volume control
- **Note**: Uses procedural audio to avoid asset files

#### `InputManager.ts`
- **Purpose**: Unified input handling
- **Supports**:
  - Touch swipes (left/right)
  - Touch taps (left/right screen zones)
  - Keyboard arrows (left/right)
  - Keyboard A/D keys
- **Callbacks**: Provides event callbacks for scene

#### `DifficultyManager.ts`
- **Purpose**: Progressive difficulty
- **Adjusts**:
  - Obstacle speed (increases over time)
  - Spawn interval (decreases over time)
- **Caps**: Maximum speed and minimum interval
- **Updates**: Every 10 seconds (configurable)

#### `DailyChallenge.ts`
- **Purpose**: Synchronized daily patterns
- **Features**:
  - Fetch/create daily seed from Supabase
  - Cache seeds locally
  - Generate deterministic seeds if offline
- **Ensures**: All players get same pattern each day

### Services

#### `SupabaseClient.ts`
- **Pattern**: Singleton
- **Purpose**: Database connection
- **Features**:
  - Reads env variables
  - Graceful fallback if unconfigured
  - Mock client for offline development
- **Used by**: All other services

#### `LeaderboardService.ts`
- **Purpose**: Score management
- **Methods**:
  - `submitScore()`: Send score with validation
  - `getTopScores()`: Fetch normal leaderboard
  - `getDailyTopScores()`: Fetch daily leaderboard
- **Security**:
  - Client-side validation
  - Score obfuscation
  - Anti-cheat checks

#### `UserService.ts`
- **Purpose**: User identity
- **Methods**:
  - `initializeUser()`: Create or load user
  - `createAnonymousUser()`: Generate random user
  - `updateDisplayName()`: Change name
- **Features**:
  - Auto-generates fun usernames
  - Persists user ID locally
  - Syncs with Supabase
  - Fallback to local-only mode

#### `StorageService.ts`
- **Purpose**: LocalStorage wrapper
- **Features**:
  - Key prefixing (namespace)
  - JSON serialization
  - Type-safe getters
  - Error handling
- **Stores**: Settings, user data, best score

### UI Components

#### `Button.ts`
- **Type**: Phaser GameObject Container
- **Features**:
  - Background image
  - Text label
  - Hover effects (scale, tint)
  - Click callback
  - Pulse animation
  - Enable/disable state
- **Usage**: All clickable buttons in menus

#### `TextStyles.ts`
- **Purpose**: Typography consistency
- **Defines**: Font sizes, colors, styles for:
  - Titles
  - Scores
  - Combos
  - Normal text
  - Buttons
  - Accents

### Configuration Files

#### `package.json`
- **Dependencies**:
  - `phaser`: Game engine
  - `@supabase/supabase-js`: Backend client
- **Dev Dependencies**:
  - `typescript`: Type checking
  - `vite`: Bundler
  - `vite-plugin-pwa`: PWA support
- **Scripts**:
  - `dev`: Development server
  - `build`: Production build
  - `preview`: Preview build

#### `vite.config.ts`
- **Bundler**: Vite configuration
- **Plugins**: PWA plugin with workbox
- **Build**: Optimization settings
  - Code splitting (Phaser, Supabase)
  - Minification
  - Asset handling
- **PWA**: Manifest and service worker config

#### `tsconfig.json`
- **TypeScript**: Compiler options
- **Target**: ES2020
- **Module**: ESNext (for Vite)
- **Strict**: Enabled for type safety
- **Paths**: Alias support (@/*)

### Backend

#### `supabase-schema.sql`
- **Tables**:
  - `users`: Player profiles
  - `scores`: Game results
  - `daily_challenges`: Daily seeds
- **Indexes**: For query performance
- **RLS**: Row-level security policies
- **Functions**:
  - `submit_score()`: Validated score insertion
  - `get_top_scores()`: Leaderboard query
- **Views**:
  - `daily_leaderboard`: Today's rankings

### Mobile

#### `capacitor.config.ts`
- **App ID**: Bundle identifier
- **App Name**: Display name
- **Web Dir**: Points to game/dist
- **Plugins**:
  - Splash screen settings
  - Status bar (dark mode)
  - Keyboard behavior

#### `mobile/package.json`
- **Dependencies**: Capacitor plugins
  - Core, Android, iOS
  - Share, Haptics, Status Bar
- **Scripts**:
  - `build:mobile`: Build web + copy to Capacitor
  - `sync`: Sync web assets to native
  - `open:android`: Open Android Studio

### Infrastructure

#### `netlify.toml`
- **Build**: Command and directory
- **Redirects**: SPA routing
- **Headers**: Security and caching
- **Optimization**: Compression, minification

#### `vercel.json`
- **Build**: Custom build command
- **Output**: Directory specification
- **Rewrites**: SPA support
- **Headers**: Security headers

## ğŸ”„ Data Flow

### Game Start Flow
```
main.ts â†’ BootScene â†’ PreloadScene â†’ MenuScene
                                    â†“
                         UserService.initializeUser()
                                    â†“
                         GameState.setUserId()
```

### Gameplay Flow
```
MenuScene (select mode) â†’ GameScene + UIScene
                             â†“
                    InputManager (touch/keyboard)
                             â†“
                    Player moves between lanes
                             â†“
                    Obstacles/BeatRings spawn (RNG)
                             â†“
                    Collision detection
                             â†“
                    Score calculation â†’ UIScene.update
                             â†“
                    Death â†’ GameOverScene
```

### Score Submission Flow
```
GameOverScene â†’ LeaderboardService.submitScore()
                    â†“
            Validation (client-side)
                    â†“
            Obfuscation
                    â†“
            SupabaseClient.from('scores').insert()
                    â†“
            submit_score() function (server-side validation)
                    â†“
            Database insertion
```

### Daily Challenge Flow
```
MenuScene (Daily Challenge button)
    â†“
DailyChallenge.getDailySeed()
    â†“
Check local cache â†’ If found, return
    â†“
Fetch from Supabase â†’ If found, cache and return
    â†“
Create new seed â†’ Insert to Supabase â†’ Cache â†’ Return
    â†“
GameState.setCurrentSeed()
    â†“
GameScene (uses seed for RNG)
```

## ğŸ® Gameplay Mechanics

### Lane System
- **Lanes**: 3 (left, center, right)
- **Positions**: Defined in gameConfig.lanes.positions
- **Movement**: Smooth interpolation between lanes
- **Input**: Swipe or tap to move

### Obstacle System
- **Spawn**: Random lane based on RNG seed
- **Speed**: Increases with difficulty
- **Interval**: Decreases with difficulty
- **Collision**: Instant game over if same lane as player

### Beat Ring System
- **Spawn**: Random lane, synced intervals
- **Timing Windows**:
  - Perfect: Â±100ms
  - Good: Â±200ms
  - Miss: Outside window
- **Scoring**:
  - Perfect: 100 Ã— combo multiplier
  - Good: 50 Ã— combo multiplier
  - Miss: Resets combo

### Combo System
- **Max Combo**: 5
- **Multipliers**: [1, 1.5, 2, 3, 5]
- **Reset**: On miss or collision

### Difficulty Scaling
- **Time-based**: Every 10 seconds
- **Speed**: +0.5 per interval (max 12)
- **Spawn Rate**: -50ms per interval (min 800ms)

## ğŸ” Security Features

### Client-Side
- Input validation
- Score range checks
- Obfuscation before transmission

### Server-Side (Supabase)
- RLS policies (users can only insert own scores)
- `submit_score()` function validation:
  - Score/duration ratio check
  - Perfect beats sanity check
  - Negative value rejection
- Rate limiting (Supabase default)

### Anti-Cheat
- Deterministic seeds (daily challenge)
- Server-side score validation
- Impossible score detection
- Duration-based max score calculation

## ğŸš€ Build Pipeline

### Development
```
npm run dev â†’ Vite dev server â†’ Hot reload
```

### Production Web
```
npm run build â†’ TypeScript compile â†’ Vite bundle
    â†’ dist/ (optimized)
    â†’ Code splitting
    â†’ Minification
    â†’ Tree shaking
```

### Mobile Android
```
npm run build (web)
    â†“
dist/ created
    â†“
npx cap copy â†’ Copies to mobile/android/app/src/main/assets/
    â†“
npx cap sync â†’ Updates native dependencies
    â†“
Android Studio â†’ Gradle build â†’ APK/AAB
```

## ğŸ“¦ Asset Generation

All visual assets are procedurally generated at runtime:

- **Player**: Neon circle with glow
- **Obstacles**: Colored rounded squares
- **Beat Rings**: Outlined circles
- **Particles**: Small dots for trails
- **Buttons**: Rounded rectangles with border
- **Background**: Animated grid lines

This eliminates the need for image files and keeps bundle size minimal.

## ğŸ¨ Theme System

Colors defined in `gameConfig.colors`:
- **Primary**: Cyan (#00ffff) - Player, UI accents
- **Secondary**: Magenta (#ff00ff) - Obstacles
- **Accent**: Yellow (#ffff00) - Perfect beats
- **Background**: Black (#000000)
- **Text**: White (#ffffff)

All can be changed in one place for easy theming.

---

**This structure enables**:
- âœ… Modular, maintainable code
- âœ… Easy feature additions
- âœ… Straightforward debugging
- âœ… Quick deployment
- âœ… Scalable architecture